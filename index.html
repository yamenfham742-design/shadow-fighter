<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-fullscreen">
    <title>âš”ï¸ Ù…Ù‚Ø§ØªÙ„ Ø§Ù„Ø¸Ù„ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ - Shadow Fighter Ultimate</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rammetto+One&family=Cinzel:wght@700&family=Orbitron:wght@900&family=Cairo:wght@700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }

        body {
            font-family: 'Cairo', 'Orbitron', sans-serif;
            background: #000;
            color: #fff;
            overflow: hidden;
            touch-action: none;
            position: fixed;
            width: 100%;
            height: 100%;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32"><circle cx="16" cy="16" r="8" fill="%23ff0000" opacity="0.6"/><circle cx="16" cy="16" r="3" fill="%23fff"/></svg>') 16 16, auto;
        }

        @keyframes stars {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        @keyframes glow {
            0%, 100% { filter: drop-shadow(0 0 5px currentColor); }
            50% { filter: drop-shadow(0 0 20px currentColor) drop-shadow(0 0 30px currentColor); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px) rotate(-1deg); }
            75% { transform: translateX(5px) rotate(1deg); }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }

        @keyframes slideIn {
            from { transform: translateY(-100px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @media screen and (orientation: portrait) {
            #rotatePrompt {
                display: flex !important;
            }
            #gameContainer {
                display: none !important;
            }
        }

        #rotatePrompt {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            text-align: center;
            padding: 20px;
        }

        #rotatePrompt .phone-icon {
            font-size: 100px;
            margin-bottom: 30px;
            animation: rotate 2s ease-in-out infinite;
            filter: drop-shadow(0 0 30px #ff0000);
        }

        @keyframes rotate {
            0%, 100% { transform: rotate(0deg); }
            50% { transform: rotate(90deg); }
        }

        #rotatePrompt h2 {
            font-size: 32px;
            margin-bottom: 20px;
            font-family: 'Cairo', sans-serif;
            font-weight: 900;
            background: linear-gradient(45deg, #ff0000, #ff6b00, #ffd700);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: glow 2s infinite;
        }

        #gameContainer {
            position: fixed;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #gameCanvas {
            width: 100%;
            height: 100%;
            background: linear-gradient(180deg, #000428 0%, #004e92 100%);
            touch-action: none;
            image-rendering: crisp-edges;
        }

        .hidden {
            display: none !important;
        }

        #menu, #gameOver {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            animation: fadeIn 0.5s;
        }

        #menu::before, #gameOver::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 0, 0, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 50%, rgba(0, 100, 255, 0.1) 0%, transparent 50%);
            animation: pulse 4s infinite;
        }

        .menu-title {
            font-family: 'Cinzel', 'Cairo', serif;
            font-size: 64px;
            font-weight: 900;
            margin-bottom: 20px;
            background: linear-gradient(45deg, #ff0000, #ff6b00, #ffd700, #ff6b00, #ff0000);
            background-size: 200% 200%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient 3s ease infinite, float 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 0, 0, 0.8));
            text-shadow: 0 0 50px rgba(255, 107, 0, 0.5);
            position: relative;
            z-index: 1;
        }

        @keyframes gradient {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .menu-subtitle {
            font-size: 24px;
            margin-bottom: 50px;
            opacity: 0.9;
            font-weight: 700;
            color: #ffd700;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: pulse 2s infinite;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 3px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 18px 50px;
            font-size: 22px;
            font-weight: bold;
            border-radius: 15px;
            margin: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-family: 'Cairo', sans-serif;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            min-width: 250px;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }

        .btn:active {
            transform: translateY(-1px) scale(1.02);
        }

        .btn-primary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            box-shadow: 0 10px 30px rgba(245, 87, 108, 0.4);
            animation: pulse 2s infinite;
        }

        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            box-shadow: 0 10px 30px rgba(250, 112, 154, 0.4);
        }

        #hud {
            position: absolute;
            top: 15px;
            left: 15px;
            right: 15px;
            pointer-events: none;
            z-index: 100;
            animation: slideIn 0.5s;
        }

        .hud-top {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            gap: 15px;
        }

        .player-stats, .enemy-info {
            background: linear-gradient(135deg, rgba(15, 12, 41, 0.95) 0%, rgba(48, 43, 99, 0.95) 100%);
            border-radius: 20px;
            padding: 15px;
            border: 3px solid rgba(255, 215, 0, 0.3);
            backdrop-filter: blur(20px);
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.7), inset 0 1px 0 rgba(255, 255, 255, 0.1);
            min-width: 220px;
        }

        .stat-label {
            font-size: 13px;
            opacity: 0.8;
            margin-bottom: 5px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #ffd700;
        }

        .bar-container {
            background: rgba(0, 0, 0, 0.7);
            border-radius: 12px;
            padding: 5px;
            margin-bottom: 10px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.5);
        }

        .bar {
            height: 24px;
            border-radius: 8px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 20px currentColor;
        }

        .bar::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.4) 0%, transparent 100%);
        }

        .bar-text {
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            font-weight: 900;
            font-size: 13px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.9);
            z-index: 1;
            font-family: 'Orbitron', monospace;
        }

        #healthBar {
            background: linear-gradient(90deg, #c0392b 0%, #e74c3c 50%, #ff6b6b 100%);
        }

        #energyBar {
            background: linear-gradient(90deg, #2980b9 0%, #3498db 50%, #5dade2 100%);
        }

        #xpBar {
            background: linear-gradient(90deg, #f39c12 0%, #f1c40f 50%, #f7dc6f 100%);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
            font-size: 13px;
        }

        .stat-item {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.1) 0%, rgba(255, 255, 255, 0.05) 100%);
            padding: 8px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s;
        }

        .stat-item:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }

        .stat-value {
            font-weight: 900;
            color: #3498db;
            font-size: 18px;
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.8);
            font-family: 'Orbitron', monospace;
        }

        #weaponInfo {
            position: absolute;
            top: 15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, rgba(243, 156, 18, 0.95) 0%, rgba(241, 196, 15, 0.95) 100%);
            padding: 15px 30px;
            border-radius: 15px;
            border: 3px solid rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(20px);
            text-align: center;
            box-shadow: 0 15px 50px rgba(243, 156, 18, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }

        #weaponName {
            font-size: 20px;
            font-weight: 900;
            color: #fff;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.9), 0 0 20px rgba(255, 215, 0, 0.8);
            font-family: 'Cinzel', serif;
            letter-spacing: 2px;
        }

        #combo {
            position: absolute;
            top: 140px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 56px;
            font-weight: 900;
            color: #ffd700;
            text-shadow: 
                0 0 30px #ff6b00, 
                0 0 60px #ff0000,
                4px 4px 8px rgba(0, 0, 0, 0.9);
            animation: comboFloat 0.5s infinite alternate;
            filter: drop-shadow(0 0 20px #ff0000);
            font-family: 'Orbitron', monospace;
        }

        @keyframes comboFloat {
            from { 
                transform: translateX(-50%) translateY(0px) scale(1); 
            }
            to { 
                transform: translateX(-50%) translateY(-8px) scale(1.1); 
            }
        }

        #waveInfo, #levelUp, #bossWarning {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.95) 0%, rgba(192, 57, 43, 0.95) 100%);
            padding: 40px 80px;
            border-radius: 25px;
            border: 5px solid rgba(255, 215, 0, 0.6);
            text-align: center;
            font-size: 48px;
            font-weight: 900;
            text-shadow: 4px 4px 8px rgba(0, 0, 0, 0.9);
            box-shadow: 0 20px 80px rgba(231, 76, 60, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: waveAnnounce 0.5s ease-out;
            font-family: 'Cinzel', serif;
            letter-spacing: 3px;
        }

        #bossWarning {
            background: linear-gradient(135deg, rgba(255, 0, 0, 0.98) 0%, rgba(139, 0, 0, 0.98) 100%);
            border-color: #ffd700;
            animation: shake 0.5s infinite, glow 1s infinite;
            font-size: 56px;
        }

        @keyframes waveAnnounce {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            50% { transform: translate(-50%, -50%) scale(1.2); }
            100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
        }

        #levelUp {
            background: linear-gradient(135deg, rgba(46, 204, 113, 0.95) 0%, rgba(39, 174, 96, 0.95) 100%);
            border-color: #f1c40f;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            pointer-events: all;
            max-width: 90%;
        }

        .control-btn {
            background: linear-gradient(135deg, rgba(52, 152, 219, 0.9) 0%, rgba(41, 128, 185, 0.9) 100%);
            border: 3px solid rgba(255, 255, 255, 0.4);
            border-radius: 20px;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            font-weight: 900;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            box-shadow: 0 10px 30px rgba(52, 152, 219, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.3);
            font-family: 'Cairo', sans-serif;
        }

        .control-btn:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.7), inset 0 3px 10px rgba(0, 0, 0, 0.3);
        }

        .control-btn.attack {
            background: linear-gradient(135deg, rgba(231, 76, 60, 0.9) 0%, rgba(192, 57, 43, 0.9) 100%);
            box-shadow: 0 10px 30px rgba(231, 76, 60, 0.5);
            animation: pulse 1.5s infinite;
        }

        .control-btn.special {
            background: linear-gradient(135deg, rgba(155, 89, 182, 0.9) 0%, rgba(142, 68, 173, 0.9) 100%);
            box-shadow: 0 10px 30px rgba(155, 89, 182, 0.5);
        }

        .control-btn.defend {
            background: linear-gradient(135deg, rgba(241, 196, 15, 0.9) 0%, rgba(243, 156, 18, 0.9) 100%);
            box-shadow: 0 10px 30px rgba(241, 196, 15, 0.5);
        }

        #gameOver .stats {
            background: linear-gradient(135deg, rgba(15, 12, 41, 0.95) 0%, rgba(48, 43, 99, 0.95) 100%);
            padding: 30px;
            border-radius: 20px;
            margin: 30px 0;
            border: 3px solid rgba(255, 215, 0, 0.4);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.8);
        }

        #gameOver .stat-row {
            display: flex;
            justify-content: space-between;
            margin: 15px 0;
            font-size: 22px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        #gameOver .stat-row span:first-child {
            color: #ecf0f1;
            font-weight: 700;
        }

        #gameOver .stat-row span:last-child {
            color: #3498db;
            font-weight: 900;
            font-family: 'Orbitron', monospace;
            text-shadow: 0 0 10px rgba(52, 152, 219, 0.8);
        }

        .particle {
            position: absolute;
            pointer-events: none;
            border-radius: 50%;
            animation: particleFade 1s forwards;
        }

        @keyframes particleFade {
            0% { 
                opacity: 1;
                transform: translateY(0) scale(1);
            }
            100% { 
                opacity: 0;
                transform: translateY(-100px) scale(0);
            }
        }

        /* Ø¥Ø¶Ø§ÙØ© ØªØ£Ø«ÙŠØ±Ø§Øª Ø§Ø­ØªØ±Ø§ÙÙŠØ© Ù„Ù„Ø®Ù„ÙÙŠØ© */
        @keyframes backgroundShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 30% 30%, rgba(255, 0, 0, 0.05) 0%, transparent 50%),
                radial-gradient(circle at 70% 70%, rgba(0, 100, 255, 0.05) 0%, transparent 50%);
            animation: backgroundShift 10s ease infinite;
            pointer-events: none;
            z-index: 0;
        }
    </style>
</head>
<body>
    <div id="rotatePrompt">
        <div class="phone-icon">ğŸ“±</div>
        <h2>ÙŠØ±Ø¬Ù‰ ØªØ¯ÙˆÙŠØ± Ø§Ù„Ø´Ø§Ø´Ø©</h2>
        <p style="font-size: 18px; opacity: 0.8;">Ø§Ù„Ù„Ø¹Ø¨Ø© ØªØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø£ÙÙ‚ÙŠ ÙÙ‚Ø·</p>
    </div>

    <div id="gameContainer">
        <canvas id="gameCanvas"></canvas>

        <div id="hud">
            <div class="hud-top">
                <div class="player-stats">
                    <div class="stat-label">ğŸ—¡ï¸ Ø§Ù„Ù…Ù‚Ø§ØªÙ„</div>
                    <div class="bar-container">
                        <div class="bar" id="healthBar" style="width: 100%;">
                            <span class="bar-text" id="healthText">100/100</span>
                        </div>
                    </div>
                    <div class="bar-container">
                        <div class="bar" id="energyBar" style="width: 100%;">
                            <span class="bar-text" id="energyText">100/100</span>
                        </div>
                    </div>
                    <div class="bar-container">
                        <div class="bar" id="xpBar" style="width: 0%;">
                            <span class="bar-text" id="xpText">0/100</span>
                        </div>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div>Ø§Ù„Ù…Ø³ØªÙˆÙ‰</div>
                            <div class="stat-value" id="playerLevel">1</div>
                        </div>
                        <div class="stat-item">
                            <div>Ø§Ù„Ø°Ù‡Ø¨</div>
                            <div class="stat-value" id="goldDisplay">0</div>
                        </div>
                    </div>
                </div>

                <div class="enemy-info">
                    <div class="stat-label">âš¡ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ù…Ø¹Ø±ÙƒØ©</div>
                    <div class="stats-grid">
                        <div class="stat-item">
                            <div>Ø§Ù„Ù…ÙˆØ¬Ø©</div>
                            <div class="stat-value" id="waveNum">1</div>
                        </div>
                        <div class="stat-item">
                            <div>Ø§Ù„Ù†Ù‚Ø§Ø·</div>
                            <div class="stat-value" id="scoreDisplay">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Ø§Ù„Ù‚Ø¶Ø§Ø¡</div>
                            <div class="stat-value" id="killCount">0</div>
                        </div>
                        <div class="stat-item">
                            <div>Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡</div>
                            <div class="stat-value" id="activeEnemies">0</div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="weaponInfo">
                <div id="weaponName">âš”ï¸ Ø³ÙŠÙ Ø§Ù„Ø¸Ù„</div>
                <div style="margin-top: 5px; font-size: 14px; opacity: 0.9;">
                    <span style="margin: 0 10px;">ğŸ’¥ <span id="weaponDmg">20</span></span>
                    <span style="margin: 0 10px;">âš¡ <span id="weaponSpd">1.0x</span></span>
                </div>
            </div>

            <div id="combo" class="hidden">
                <span id="comboCount">0</span>
                <span style="font-size: 0.5em;"> COMBO!</span>
            </div>

            <div id="waveInfo" class="hidden">Ù…ÙˆØ¬Ø© <span id="currentWave">1</span></div>
            <div id="levelUp" class="hidden">ğŸ‰ Ø§Ù„Ù…Ø³ØªÙˆÙ‰ <span id="newLevel">2</span> ğŸ‰</div>
            <div id="bossWarning" class="hidden">âš ï¸ ØªØ­Ø°ÙŠØ±: Ø§Ù„Ø¨ÙˆØµ Ù‚Ø§Ø¯Ù…! âš ï¸</div>
        </div>

        <div id="controls">
            <div class="control-btn" id="btnLeft">â—„</div>
            <div class="control-btn" id="btnRight">â–º</div>
            <div class="control-btn" id="btnJump">â–²</div>
            <div class="control-btn attack" id="btnAttack">âš”ï¸</div>
            <div class="control-btn special" id="btnSpecial">âœ¨</div>
            <div class="control-btn defend" id="btnDefend">ğŸ›¡ï¸</div>
        </div>
    </div>

    <div id="menu">
        <h1 class="menu-title">âš”ï¸ Ù…Ù‚Ø§ØªÙ„ Ø§Ù„Ø¸Ù„ Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ âš”ï¸</h1>
        <p class="menu-subtitle">Ø£Ù‚ÙˆÙ‰ Ù„Ø¹Ø¨Ø© Ù‚ØªØ§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ø¥Ø·Ù„Ø§Ù‚</p>
        <button class="btn btn-primary" id="btnStart">ğŸ® Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…ØºØ§Ù…Ø±Ø©</button>
        <button class="btn btn-success" id="btnEndless">â™¾ï¸ ÙˆØ¶Ø¹ Ù„Ø§ Ù†Ù‡Ø§Ø¦ÙŠ</button>
        <button class="btn btn-danger" id="btnInstructions">ğŸ“– Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª</button>
    </div>

    <div id="gameOver" class="hidden">
        <h1 class="menu-title" style="color: #e74c3c;">ğŸ’€ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© ğŸ’€</h1>
        <div class="stats">
            <div class="stat-row">
                <span>ğŸ† Ø§Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</span>
                <span id="finalScore">0</span>
            </div>
            <div class="stat-row">
                <span>âš”ï¸ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù‚Ø¶Ø§Ø¡:</span>
                <span id="finalKills">0</span>
            </div>
            <div class="stat-row">
                <span>ğŸ”¥ Ø£Ø¹Ù„Ù‰ ÙƒÙˆÙ…Ø¨Ùˆ:</span>
                <span id="finalCombo">0</span>
            </div>
            <div class="stat-row">
                <span>ğŸŒŠ Ø¢Ø®Ø± Ù…ÙˆØ¬Ø©:</span>
                <span id="finalWave">0</span>
            </div>
            <div class="stat-row">
                <span>ğŸ’° Ø§Ù„Ø°Ù‡Ø¨ Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹:</span>
                <span id="finalGold">0</span>
            </div>
        </div>
        <button class="btn btn-primary" id="btnRestart">ğŸ”„ Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
        <button class="btn btn-success" id="btnMenu">ğŸ  Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</button>
    </div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            game.ground = canvas.height - 100;
        });

        // ØªØ¹Ø±ÙŠÙ Ø§Ù„Ø£Ø³Ù„Ø­Ø© Ù…Ø¹ ØªØ­Ø³ÙŠÙ†Ø§Øª
        const WEAPONS = {
            sword: { 
                name: 'âš”ï¸ Ø³ÙŠÙ Ø§Ù„Ø¸Ù„', 
                dmg: 25, 
                special: 60, 
                speed: 1.2, 
                range: 80, 
                color: '#ff0000',
                glow: '#ff6b00'
            },
            axe: { 
                name: 'ğŸª“ ÙØ£Ø³ Ø§Ù„Ø¯Ù…Ø§Ø±', 
                dmg: 40, 
                special: 100, 
                speed: 0.8, 
                range: 70, 
                color: '#8b0000',
                glow: '#ff0000'
            },
            spear: { 
                name: 'ğŸ—¡ï¸ Ø±Ù…Ø­ Ø§Ù„Ø¨Ø±Ù‚', 
                dmg: 30, 
                special: 75, 
                speed: 1.5, 
                range: 120, 
                color: '#ffd700',
                glow: '#ffff00'
            },
            katana: { 
                name: 'âš¡ ÙƒØ§ØªØ§Ù†Ø§ Ø§Ù„Ø³Ø±Ø¹Ø©', 
                dmg: 35, 
                special: 85, 
                speed: 2.0, 
                range: 90, 
                color: '#00ffff',
                glow: '#00ff00'
            },
            hammer: { 
                name: 'ğŸ”¨ Ù…Ø·Ø±Ù‚Ø© Ø§Ù„Ø±Ø¹Ø¯', 
                dmg: 50, 
                special: 120, 
                speed: 0.6, 
                range: 60, 
                color: '#9400d3',
                glow: '#ff00ff'
            }
        };

        // ØªØ¹Ø±ÙŠÙ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
        const ENEMY_TYPES = [
            { 
                name: 'Ø²ÙˆÙ…Ø¨ÙŠ', 
                hp: 60, 
                dmg: 15, 
                speed: 1.5, 
                xp: 25, 
                gold: 15,
                color: '#2ecc71',
                size: 40,
                glow: '#27ae60'
            },
            { 
                name: 'Ù‡ÙŠÙƒÙ„ Ø¹Ø¸Ù…ÙŠ', 
                hp: 50, 
                dmg: 20, 
                speed: 2.2, 
                xp: 35, 
                gold: 25,
                color: '#ecf0f1',
                size: 42,
                glow: '#bdc3c7'
            },
            { 
                name: 'Ø´Ø¨Ø­', 
                hp: 40, 
                dmg: 25, 
                speed: 3.0, 
                xp: 45, 
                gold: 35,
                color: '#3498db',
                size: 45,
                glow: '#2980b9'
            },
            { 
                name: 'Ø¹ÙØ±ÙŠØª', 
                hp: 90, 
                dmg: 30, 
                speed: 1.8, 
                xp: 60, 
                gold: 50,
                color: '#e74c3c',
                size: 50,
                glow: '#c0392b'
            },
            { 
                name: 'Ù…Ø®Ù„ÙˆÙ‚ Ø§Ù„Ø¸Ù„', 
                hp: 120, 
                dmg: 35, 
                speed: 2.5, 
                xp: 80, 
                gold: 70,
                color: '#34495e',
                size: 55,
                glow: '#2c3e50'
            },
            { 
                name: 'Ù…Ø­Ø§Ø±Ø¨ Ø§Ù„Ø¸Ù„Ø§Ù…', 
                hp: 150, 
                dmg: 45, 
                speed: 2.0, 
                xp: 100, 
                gold: 90,
                color: '#8e44ad',
                size: 58,
                glow: '#9b59b6'
            },
            { 
                name: 'ØªÙ†ÙŠÙ† ØµØºÙŠØ±', 
                hp: 200, 
                dmg: 55, 
                speed: 1.5, 
                xp: 150, 
                gold: 120,
                color: '#e67e22',
                size: 65,
                glow: '#d35400'
            },
            { 
                name: 'ÙˆØ­Ø´ Ø§Ù„Ù‡Ø§ÙˆÙŠØ©', 
                hp: 250, 
                dmg: 65, 
                speed: 1.8, 
                xp: 200, 
                gold: 150,
                color: '#c0392b',
                size: 70,
                glow: '#e74c3c'
            }
        ];

        // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø¨ÙˆØ³Ø§Øª Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ©
        const BOSS_TYPES = [
            {
                name: 'ğŸ‘¹ Ù…Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù…',
                hp: 800,
                dmg: 80,
                speed: 1.0,
                xp: 500,
                gold: 500,
                color: '#8b0000',
                size: 100,
                glow: '#ff0000',
                special: true
            },
            {
                name: 'ğŸ‰ Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ',
                hp: 1500,
                dmg: 100,
                speed: 0.8,
                xp: 1000,
                gold: 1000,
                color: '#ff4500',
                size: 120,
                glow: '#ffd700',
                special: true
            },
            {
                name: 'ğŸ‘¾ Ø¥Ù„Ù‡ Ø§Ù„Ø¯Ù…Ø§Ø±',
                hp: 2500,
                dmg: 120,
                speed: 1.2,
                xp: 2000,
                gold: 2000,
                color: '#4b0082',
                size: 140,
                glow: '#9400d3',
                special: true
            }
        ];

        // Ø­Ø§Ù„Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
        const game = {
            state: 'menu',
            ground: canvas.height - 100,
            player: {
                x: 150,
                y: 0,
                width: 50,
                height: 70,
                velY: 0,
                jumping: false,
                facingRight: true,
                health: 100,
                maxHealth: 100,
                energy: 100,
                maxEnergy: 100,
                weapon: 'sword',
                isAttacking: false,
                isDefending: false,
                invulnerable: false,
                speed: 4
            },
            enemies: [],
            particles: [],
            score: 0,
            kills: 0,
            combo: 0,
            maxCombo: 0,
            comboTimer: 0,
            wave: 1,
            waveEnemies: 5,
            endless: false,
            gold: 0,
            level: 1,
            xp: 0,
            xpNeeded: 100,
            keys: {},
            bossActive: false,
            currentBoss: null
        };

        // ÙØ¦Ø© Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª Ø§Ù„Ù…Ø­Ø³Ù†Ø©
        class Particle {
            constructor(x, y, color, size = 8) {
                this.x = x;
                this.y = y;
                this.velX = (Math.random() - 0.5) * 10;
                this.velY = (Math.random() - 0.5) * 10 - 5;
                this.color = color;
                this.size = size;
                this.life = 60;
                this.maxLife = 60;
                this.glow = Math.random() * 10 + 10;
            }

            update() {
                this.x += this.velX;
                this.y += this.velY;
                this.velY += 0.3;
                this.life--;
                this.velX *= 0.98;
            }

            draw() {
                const alpha = this.life / this.maxLife;
                ctx.shadowBlur = this.glow;
                ctx.shadowColor = this.color;
                ctx.globalAlpha = alpha;
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size * alpha, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowBlur = 0;
                ctx.globalAlpha = 1;
            }
        }

        // ÙØ¦Ø© Ø§Ù„Ø¹Ø¯Ùˆ Ø§Ù„Ù…Ø­Ø³Ù†Ø©
        class Enemy {
            constructor(type, x, wave, isBoss = false) {
                this.type = isBoss ? type : {...type};
                this.x = x;
                this.y = game.ground;
                this.width = type.size;
                this.height = type.size * 1.4;
                this.maxHealth = type.hp * (1 + wave * 0.15);
                this.health = this.maxHealth;
                this.damage = type.dmg * (1 + wave * 0.1);
                this.speed = type.speed;
                this.xpValue = type.xp * (1 + wave * 0.2);
                this.goldValue = type.gold * (1 + wave * 0.2);
                this.attackCooldown = 0;
                this.isBoss = isBoss;
                this.glowIntensity = 0;
                this.attackAnimation = 0;
            }

            update() {
                const dx = game.player.x - this.x;
                const distance = Math.abs(dx);

                if (distance > 60) {
                    this.x += Math.sign(dx) * this.speed;
                } else {
                    if (this.attackCooldown <= 0) {
                        this.attack();
                        this.attackCooldown = this.isBoss ? 45 : 60;
                        this.attackAnimation = 15;
                    }
                }

                if (this.attackCooldown > 0) this.attackCooldown--;
                if (this.attackAnimation > 0) this.attackAnimation--;
                
                this.glowIntensity = Math.sin(Date.now() / 200) * 5 + 10;
            }

            attack() {
                if (!game.player.invulnerable) {
                    const actualDamage = game.player.isDefending ? this.damage * 0.3 : this.damage;
                    game.player.health -= actualDamage;
                    game.player.invulnerable = true;
                    
                    // ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¶Ø±Ø±
                    createParticles(game.player.x, game.player.y - 35, '#ff0000', 20);
                    
                    setTimeout(() => {
                        game.player.invulnerable = false;
                    }, 800);

                    if (game.player.health <= 0) {
                        gameOver();
                    }
                }

                game.combo = 0;
                document.getElementById('combo').classList.add('hidden');
            }

            takeDamage(dmg) {
                this.health -= dmg;
                createParticles(this.x, this.y - this.height/2, this.type.color, 15);
                return this.health <= 0;
            }

            draw() {
                // ØªÙˆÙ‡Ø¬ Ø§Ù„Ø¹Ø¯Ùˆ
                ctx.shadowBlur = this.glowIntensity + (this.isBoss ? 20 : 0);
                ctx.shadowColor = this.type.glow;

                // Ø¬Ø³Ù… Ø§Ù„Ø¹Ø¯Ùˆ
                const shake = this.attackAnimation > 0 ? Math.sin(this.attackAnimation * 2) * 3 : 0;
                ctx.fillStyle = this.type.color;
                ctx.fillRect(
                    this.x - this.width/2 + shake,
                    this.y - this.height,
                    this.width,
                    this.height
                );

                // Ø¹ÙŠÙˆÙ† Ù…ØªÙˆÙ‡Ø¬Ø©
                ctx.shadowBlur = 15;
                ctx.shadowColor = '#ff0000';
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(this.x - 10, this.y - this.height + 15, 8, 8);
                ctx.fillRect(this.x + 2, this.y - this.height + 15, 8, 8);

                // Ø´Ø±ÙŠØ· Ø§Ù„ØµØ­Ø© ÙÙˆÙ‚ Ø§Ù„Ø¹Ø¯Ùˆ
                const barWidth = this.width * 1.2;
                const barHeight = this.isBoss ? 12 : 8;
                const barY = this.y - this.height - 20;
                
                ctx.shadowBlur = 0;
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(this.x - barWidth/2, barY, barWidth, barHeight);
                
                const healthPercent = this.health / this.maxHealth;
                const healthColor = healthPercent > 0.5 ? '#2ecc71' : healthPercent > 0.25 ? '#f39c12' : '#e74c3c';
                ctx.fillStyle = healthColor;
                ctx.fillRect(this.x - barWidth/2, barY, barWidth * healthPercent, barHeight);

                // Ø¥Ø·Ø§Ø± Ù„Ù„Ø¨ÙˆØ³
                if (this.isBoss) {
                    ctx.strokeStyle = '#ffd700';
                    ctx.lineWidth = 3;
                    ctx.strokeRect(this.x - barWidth/2, barY, barWidth, barHeight);
                    
                    // ØªØ§Ø¬ Ø§Ù„Ø¨ÙˆØ³
                    ctx.fillStyle = '#ffd700';
                    ctx.font = 'bold 20px Arial';
                    ctx.textAlign = 'center';
                    ctx.fillText('ğŸ‘‘', this.x, barY - 15);
                }

                ctx.shadowBlur = 0;
            }
        }

        function createParticles(x, y, color, count) {
            for (let i = 0; i < count; i++) {
                game.particles.push(new Particle(x, y, color));
            }
        }

        // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ØªØ­ÙƒÙ…
        function setupControls() {
            ['btnLeft', 'btnRight', 'btnJump', 'btnAttack', 'btnSpecial', 'btnDefend'].forEach(id => {
                const btn = document.getElementById(id);
                
                btn.addEventListener('touchstart', (e) => {
                    e.preventDefault();
                    handleControl(id, true);
                });

                btn.addEventListener('touchend', (e) => {
                    e.preventDefault();
                    handleControl(id, false);
                });

                btn.addEventListener('mousedown', (e) => {
                    e.preventDefault();
                    handleControl(id, true);
                });

                btn.addEventListener('mouseup', (e) => {
                    e.preventDefault();
                    handleControl(id, false);
                });
            });

            // ØªØ­ÙƒÙ… Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            document.addEventListener('keydown', (e) => {
                game.keys[e.key.toLowerCase()] = true;
                if (e.key === ' ' || e.key.toLowerCase() === 'w') game.keys['jump'] = true;
            });

            document.addEventListener('keyup', (e) => {
                game.keys[e.key.toLowerCase()] = false;
                if (e.key === ' ' || e.key.toLowerCase() === 'w') game.keys['jump'] = false;
            });
        }

        function handleControl(id, pressed) {
            const action = id.replace('btn', '').toLowerCase();
            if (action === 'left') game.keys['a'] = pressed;
            if (action === 'right') game.keys['d'] = pressed;
            if (action === 'jump') game.keys['jump'] = pressed;
            if (action === 'attack' && pressed) attack();
            if (action === 'special' && pressed) {
                if (game.player.energy >= 30) {
                    game.player.energy -= 30;
                    specialAttack();
                }
            }
            if (action === 'defend') game.player.isDefending = pressed;
        }

        // Ø±ÙØ¹ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
        function gainXP(amount) {
            game.xp += amount;
            if (game.xp >= game.xpNeeded) {
                game.level++;
                game.xp -= game.xpNeeded;
                game.xpNeeded = Math.floor(game.xpNeeded * 1.5);
                
                // ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„Ù…Ø³ØªÙˆÙ‰
                game.player.maxHealth += 20;
                game.player.health = game.player.maxHealth;
                game.player.maxEnergy += 10;
                game.player.energy = game.player.maxEnergy;

                const elem = document.getElementById('levelUp');
                document.getElementById('newLevel').textContent = game.level;
                elem.classList.remove('hidden');
                setTimeout(() => elem.classList.add('hidden'), 2000);
                
                createParticles(game.player.x, game.player.y - 35, '#2ecc71', 30);
            }
        }

        // Ø¥Ø¹Ù„Ø§Ù† Ø§Ù„Ù…ÙˆØ¬Ø©
        function announceWave() {
            const elem = document.getElementById('waveInfo');
            document.getElementById('currentWave').textContent = game.wave;
            elem.classList.remove('hidden');
            setTimeout(() => elem.classList.add('hidden'), 2000);

            // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø¨ÙˆØ³Ø§Øª
            const isBossWave = game.wave % 5 === 0;
            
            if (isBossWave && !game.endless) {
                setTimeout(() => {
                    document.getElementById('bossWarning').classList.remove('hidden');
                    setTimeout(() => {
                        document.getElementById('bossWarning').classList.add('hidden');
                        spawnBoss();
                    }, 2500);
                }, 2000);
            } else {
                spawnEnemies();
            }
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø¨ÙˆØ³
        function spawnBoss() {
            game.bossActive = true;
            const bossIndex = Math.min(Math.floor(game.wave / 5) - 1, BOSS_TYPES.length - 1);
            const bossType = BOSS_TYPES[bossIndex];
            game.currentBoss = new Enemy(bossType, canvas.width - 100, game.wave, true);
            game.enemies.push(game.currentBoss);
        }

        // Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
        function spawnEnemies() {
            game.waveEnemies = 5 + game.wave * 2;
            for (let i = 0; i < game.waveEnemies; i++) {
                setTimeout(() => {
                    const typeIndex = Math.min(Math.floor(Math.random() * (5 + game.wave)), ENEMY_TYPES.length - 1);
                    const type = ENEMY_TYPES[typeIndex];
                    const x = canvas.width + Math.random() * 200;
                    game.enemies.push(new Enemy(type, x, game.wave));
                }, i * 800);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù„Ø¹Ø¨Ø©
        function update() {
            if (game.state !== 'playing') return;

            // Ø­Ø±ÙƒØ© Ø§Ù„Ù„Ø§Ø¹Ø¨
            if (game.keys['a']) {
                game.player.x -= game.player.speed;
                game.player.facingRight = false;
            }
            if (game.keys['d']) {
                game.player.x += game.player.speed;
                game.player.facingRight = true;
            }

            // Ø§Ù„Ù‚ÙØ²
            if (game.keys['jump'] && !game.player.jumping) {
                game.player.velY = -15;
                game.player.jumping = true;
                createParticles(game.player.x, game.player.y, '#3498db', 10);
            }

            // ÙÙŠØ²ÙŠØ§Ø¡ Ø§Ù„Ù‚ÙØ²
            game.player.y += game.player.velY;
            game.player.velY += 0.7;

            if (game.player.y >= game.ground) {
                game.player.y = game.ground;
                game.player.velY = 0;
                game.player.jumping = false;
            }

            // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©
            game.player.x = Math.max(50, Math.min(canvas.width - 50, game.player.x));

            // Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø·Ø§Ù‚Ø©
            if (game.player.energy < game.player.maxEnergy) {
                game.player.energy += 0.15;
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
            game.enemies.forEach(enemy => enemy.update());

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
            game.particles = game.particles.filter(p => {
                p.update();
                return p.life > 0;
            });

            // Ù…Ø¤Ù‚Øª Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ
            if (game.comboTimer > 0) {
                game.comboTimer--;
            } else if (game.combo > 1) {
                game.combo = 0;
                document.getElementById('combo').classList.add('hidden');
            }

            // Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ù„ÙˆØ­Ø© Ø§Ù„Ù…ÙØ§ØªÙŠØ­
            if (game.keys['j']) attack();
            if (game.keys['k']) {
                if (game.player.energy >= 30) {
                    game.player.energy -= 30;
                    specialAttack();
                    game.keys['k'] = false;
                }
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù…ÙˆØ¬Ø©
            if (game.enemies.length === 0 && !game.bossActive) {
                game.wave++;
                if (game.wave > 20 && !game.endless) {
                    gameOver();
                } else {
                    announceWave();
                }
            }

            updateHUD();
        }

        // Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø§Ù„Ø¹Ø§Ø¯ÙŠ
        function attack() {
            if (game.player.isAttacking) return;

            game.player.isAttacking = true;
            setTimeout(() => game.player.isAttacking = false, 500 / WEAPONS[game.player.weapon].speed);

            const weapon = WEAPONS[game.player.weapon];
            const range = weapon.range;
            const damage = weapon.dmg * (1 + game.level * 0.1);

            createParticles(game.player.x, game.player.y - 35, weapon.color, 12);

            game.enemies = game.enemies.filter(enemy => {
                if (Math.abs(enemy.x - game.player.x) < range) {
                    if (enemy.takeDamage(damage)) {
                        game.score += enemy.xpValue * (1 + game.combo / 10);
                        game.gold += enemy.goldValue;
                        game.kills++;
                        game.combo++;
                        game.maxCombo = Math.max(game.maxCombo, game.combo);
                        game.comboTimer = 120;
                        gainXP(enemy.xpValue);
                        updateCombo();
                        createParticles(enemy.x, enemy.y - enemy.height/2, '#ffd700', 20);
                        
                        if (enemy.isBoss) {
                            game.bossActive = false;
                            game.currentBoss = null;
                            createParticles(enemy.x, enemy.y - enemy.height/2, '#ffd700', 50);
                        }
                        return false;
                    }
                }
                return true;
            });
        }

        // Ø§Ù„Ù‡Ø¬ÙˆÙ… Ø§Ù„Ø®Ø§Øµ
        function specialAttack() {
            const weapon = WEAPONS[game.player.weapon];
            const range = weapon.range * 2;
            const damage = weapon.special * (1 + game.level * 0.15);

            createParticles(game.player.x, game.player.y - 35, weapon.glow, 40);

            game.enemies = game.enemies.filter(enemy => {
                if (Math.abs(enemy.x - game.player.x) < range) {
                    if (enemy.takeDamage(damage)) {
                        game.score += enemy.xpValue * 2 * (1 + game.combo / 10);
                        game.gold += enemy.goldValue * 2;
                        game.kills++;
                        game.combo++;
                        game.maxCombo = Math.max(game.maxCombo, game.combo);
                        game.comboTimer = 120;
                        gainXP(enemy.xpValue * 1.5);
                        updateCombo();
                        createParticles(enemy.x, enemy.y - enemy.height/2, '#ff00ff', 30);
                        
                        if (enemy.isBoss) {
                            game.bossActive = false;
                            game.currentBoss = null;
                            createParticles(enemy.x, enemy.y - enemy.height/2, '#ffd700', 60);
                        }
                        return false;
                    }
                }
                return true;
            });
        }

        function updateCombo() {
            if (game.combo > 1) {
                document.getElementById('combo').classList.remove('hidden');
                document.getElementById('comboCount').textContent = game.combo;
            }
        }

        // Ø±Ø³Ù… Ø§Ù„Ù„Ø¹Ø¨Ø©
        function draw() {
            // Ø®Ù„ÙÙŠØ© Ù…ØªØ­Ø±ÙƒØ©
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0f0c29');
            gradient.addColorStop(0.5, '#302b63');
            gradient.addColorStop(1, '#24243e');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Ù†Ø¬ÙˆÙ… Ù…ØªÙ„Ø£Ù„Ø¦Ø©
            for (let i = 0; i < 100; i++) {
                const alpha = Math.sin(Date.now() / 1000 + i) * 0.5 + 0.5;
                ctx.fillStyle = `rgba(255, 255, 255, ${alpha})`;
                ctx.beginPath();
                ctx.arc((i * 371 % canvas.width), (i * 173 % canvas.height), Math.random() * 2 + 1, 0, Math.PI * 2);
                ctx.fill();
            }

            // Ø§Ù„Ø£Ø±Ø¶
            const groundGradient = ctx.createLinearGradient(0, game.ground, 0, canvas.height);
            groundGradient.addColorStop(0, '#1a1a2a');
            groundGradient.addColorStop(0.5, '#0f0f1a');
            groundGradient.addColorStop(1, '#0a0a15');
            ctx.fillStyle = groundGradient;
            ctx.fillRect(0, game.ground, canvas.width, canvas.height - game.ground);

            // Ø®Ø· Ø§Ù„Ø£Ø±Ø¶ Ø§Ù„Ù…ØªÙˆÙ‡Ø¬
            ctx.strokeStyle = '#3498db';
            ctx.lineWidth = 2;
            ctx.shadowBlur = 10;
            ctx.shadowColor = '#3498db';
            ctx.beginPath();
            ctx.moveTo(0, game.ground);
            ctx.lineTo(canvas.width, game.ground);
            ctx.stroke();
            ctx.shadowBlur = 0;

            if (game.state !== 'playing') return;

            // Ø±Ø³Ù… Ø§Ù„Ø¬Ø³ÙŠÙ…Ø§Øª
            game.particles.forEach(p => p.draw());

            // Ø±Ø³Ù… Ø§Ù„Ù„Ø§Ø¹Ø¨
            const playerColor = game.player.invulnerable && Math.floor(Date.now() / 100) % 2 ? '#555' : '#1a1a1a';
            
            ctx.shadowBlur = 15;
            ctx.shadowColor = '#ff0000';
            ctx.fillStyle = playerColor;
            ctx.fillRect(
                game.player.x - game.player.width/2,
                game.player.y - game.player.height,
                game.player.width,
                game.player.height
            );

            // Ø¹ÙŠÙˆÙ† Ù…ØªÙˆÙ‡Ø¬Ø©
            ctx.shadowBlur = 20;
            ctx.shadowColor = '#ff0000';
            ctx.fillStyle = '#ff0000';
            const eyeX = game.player.facingRight ? 10 : -10;
            ctx.fillRect(game.player.x + eyeX - 5, game.player.y - game.player.height + 20, 8, 8);

            // Ø¯Ø±Ø¹ Ø§Ù„Ø¯ÙØ§Ø¹
            if (game.player.isDefending) {
                ctx.strokeStyle = '#ffd700';
                ctx.lineWidth = 4;
                ctx.globalAlpha = 0.7;
                ctx.shadowBlur = 20;
                ctx.shadowColor = '#ffd700';
                ctx.beginPath();
                ctx.arc(game.player.x, game.player.y - game.player.height/2, game.player.width * 1.3, 0, Math.PI * 2);
                ctx.stroke();
                ctx.globalAlpha = 1;
            }

            // Ø±Ø³Ù… Ø§Ù„Ø³Ù„Ø§Ø­
            const weapon = WEAPONS[game.player.weapon];
            const weaponDir = game.player.facingRight ? 1 : -1;
            const weaponX = game.player.x + weaponDir * 25;
            const weaponY = game.player.y - game.player.height / 2;
            
            ctx.strokeStyle = weapon.color;
            ctx.lineWidth = 5;
            ctx.shadowBlur = 15;
            ctx.shadowColor = weapon.glow;
            ctx.beginPath();
            ctx.moveTo(weaponX, weaponY);
            ctx.lineTo(weaponX + weaponDir * 30, weaponY - 20);
            ctx.stroke();

            // ØªØ£Ø«ÙŠØ± Ø§Ù„Ù‡Ø¬ÙˆÙ…
            if (game.player.isAttacking) {
                ctx.strokeStyle = weapon.glow;
                ctx.lineWidth = 3;
                ctx.globalAlpha = 0.5;
                ctx.beginPath();
                ctx.arc(weaponX + weaponDir * 30, weaponY - 20, 30, 0, Math.PI * 2);
                ctx.stroke();
                ctx.globalAlpha = 1;
            }

            ctx.shadowBlur = 0;

            // Ø±Ø³Ù… Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
            game.enemies.forEach(enemy => enemy.draw());

            // Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡
            document.getElementById('activeEnemies').textContent = game.enemies.length;
        }

        function updateHUD() {
            const healthPercent = (game.player.health / game.player.maxHealth) * 100;
            const energyPercent = (game.player.energy / game.player.maxEnergy) * 100;
            const xpPercent = (game.xp / game.xpNeeded) * 100;

            document.getElementById('healthBar').style.width = Math.max(0, healthPercent) + '%';
            document.getElementById('energyBar').style.width = Math.max(0, energyPercent) + '%';
            document.getElementById('xpBar').style.width = Math.max(0, xpPercent) + '%';

            document.getElementById('healthText').textContent = Math.floor(Math.max(0, game.player.health)) + '/' + game.player.maxHealth;
            document.getElementById('energyText').textContent = Math.floor(game.player.energy) + '/' + game.player.maxEnergy;
            document.getElementById('xpText').textContent = Math.floor(game.xp) + '/' + game.xpNeeded;

            document.getElementById('scoreDisplay').textContent = Math.floor(game.score);
            document.getElementById('killCount').textContent = game.kills;
            document.getElementById('goldDisplay').textContent = Math.floor(game.gold);
            document.getElementById('waveNum').textContent = game.wave;
            document.getElementById('playerLevel').textContent = game.level;

            const weapon = WEAPONS[game.player.weapon];
            document.getElementById('weaponName').textContent = weapon.name;
            document.getElementById('weaponDmg').textContent = Math.floor(weapon.dmg * (1 + game.level * 0.1));
            document.getElementById('weaponSpd').textContent = weapon.speed.toFixed(1) + 'x';
        }

        function startGame(endless = false) {
            game.state = 'playing';
            game.score = 0;
            game.kills = 0;
            game.combo = 0;
            game.maxCombo = 0;
            game.wave = 1;
            game.endless = endless;
            game.gold = 0;
            game.level = 1;
            game.xp = 0;
            game.xpNeeded = 100;
            game.player.health = 100;
            game.player.maxHealth = 100;
            game.player.energy = 100;
            game.player.maxEnergy = 100;
            game.player.x = 150;
            game.player.y = game.ground;
            game.player.weapon = 'sword';
            game.enemies = [];
            game.particles = [];
            game.bossActive = false;
            game.currentBoss = null;

            document.getElementById('menu').classList.add('hidden');
            document.getElementById('gameOver').classList.add('hidden');
            
            announceWave();
            updateHUD();
        }

        function gameOver() {
            game.state = 'gameover';
            document.getElementById('finalScore').textContent = Math.floor(game.score);
            document.getElementById('finalKills').textContent = game.kills;
            document.getElementById('finalCombo').textContent = game.maxCombo;
            document.getElementById('finalWave').textContent = game.wave;
            document.getElementById('finalGold').textContent = Math.floor(game.gold);
            document.getElementById('gameOver').classList.remove('hidden');
        }

        // Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©
        document.getElementById('btnStart').addEventListener('click', () => startGame(false));
        document.getElementById('btnEndless').addEventListener('click', () => startGame(true));
        document.getElementById('btnRestart').addEventListener('click', () => startGame(game.endless));
        document.getElementById('btnMenu').addEventListener('click', () => {
            game.state = 'menu';
            document.getElementById('gameOver').classList.add('hidden');
            document.getElementById('menu').classList.remove('hidden');
        });
        
        document.getElementById('btnInstructions').addEventListener('click', () => {
            alert('ğŸ® Ø§Ù„ØªØ­ÙƒÙ…:\n\n' +
                'ğŸ“± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„:\n' +
                'â—„ â–º - Ø§Ù„Ø­Ø±ÙƒØ© ÙŠÙ…ÙŠÙ†Ø§Ù‹ ÙˆÙŠØ³Ø§Ø±Ø§Ù‹\n' +
                'â–² - Ø§Ù„Ù‚ÙØ² (ØªÙØ§Ø¯ÙŠ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª)\n' +
                'âš”ï¸ - Ù‡Ø¬ÙˆÙ… Ø¹Ø§Ø¯ÙŠ\n' +
                'âœ¨ - Ù‡Ø¬ÙˆÙ… Ø®Ø§Øµ Ù‚ÙˆÙŠ (ÙŠØ³ØªÙ‡Ù„Ùƒ 30 Ø·Ø§Ù‚Ø©)\n' +
                'ğŸ›¡ï¸ - Ø§Ù„Ø¯ÙØ§Ø¹ (ÙŠÙ‚Ù„Ù„ Ø§Ù„Ø¶Ø±Ø± 70%)\n\n' +
                'âŒ¨ï¸ Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±:\n' +
                'A/D - Ø§Ù„Ø­Ø±ÙƒØ©\n' +
                'W/Space - Ø§Ù„Ù‚ÙØ²\n' +
                'J - Ù‡Ø¬ÙˆÙ… Ø¹Ø§Ø¯ÙŠ\n' +
                'K - Ù‡Ø¬ÙˆÙ… Ø®Ø§Øµ\n' +
                'S - Ø§Ù„Ø¯ÙØ§Ø¹\n\n' +
                'ğŸ¯ Ù†ØµØ§Ø¦Ø­ Ø§Ø³ØªØ±Ø§ØªÙŠØ¬ÙŠØ©:\n' +
                'â€¢ Ø§Ø­ÙØ¸ Ø§Ù„Ø·Ø§Ù‚Ø© Ù„Ù„Ù‡Ø¬Ù…Ø§Øª Ø§Ù„Ø®Ø§ØµØ© Ø§Ù„Ù‚ÙˆÙŠØ©\n' +
                'â€¢ Ø§Ù„ÙƒÙˆÙ…Ø¨Ùˆ ÙŠØ¶Ø§Ø¹Ù Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØ§Ù„Ø°Ù‡Ø¨\n' +
                'â€¢ Ø§Ù„Ø¯ÙØ§Ø¹ ÙŠÙ‚Ù„Ù„ Ø§Ù„Ø¶Ø±Ø± 70%\n' +
                'â€¢ ÙƒÙ„ Ù…Ø³ØªÙˆÙ‰ ÙŠØ²ÙŠØ¯ Ù‚ÙˆØªÙƒ\n' +
                'â€¢ Ø§Ù„Ø¨ÙˆØ³Ø§Øª ÙŠØ¸Ù‡Ø±ÙˆÙ† ÙƒÙ„ 5 Ù…ÙˆØ¬Ø§Øª\n' +
                'â€¢ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù‚ÙØ² Ù„ØªÙØ§Ø¯ÙŠ Ø§Ù„Ù‡Ø¬Ù…Ø§Øª\n' +
                'â€¢ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¡ ÙŠÙ‚ÙˆÙˆÙ† Ù…Ø¹ ÙƒÙ„ Ù…ÙˆØ¬Ø©\n\n' +
                'âš”ï¸ Ø§Ù„Ø£Ø³Ù„Ø­Ø© Ø§Ù„Ù…ØªÙˆÙØ±Ø©:\n' +
                'â€¢ Ø³ÙŠÙ Ø§Ù„Ø¸Ù„ - Ù…ØªÙˆØ§Ø²Ù†\n' +
                'â€¢ ÙØ£Ø³ Ø§Ù„Ø¯Ù…Ø§Ø± - Ù‚ÙˆÙŠ ÙˆØ¨Ø·ÙŠØ¡\n' +
                'â€¢ Ø±Ù…Ø­ Ø§Ù„Ø¨Ø±Ù‚ - Ù…Ø¯Ù‰ Ø¨Ø¹ÙŠØ¯\n' +
                'â€¢ ÙƒØ§ØªØ§Ù†Ø§ Ø§Ù„Ø³Ø±Ø¹Ø© - Ø³Ø±ÙŠØ¹ Ø¬Ø¯Ø§Ù‹\n' +
                'â€¢ Ù…Ø·Ø±Ù‚Ø© Ø§Ù„Ø±Ø¹Ø¯ - Ø¶Ø±Ø± Ù‡Ø§Ø¦Ù„\n\n' +
                'ğŸ‘¹ Ø§Ù„Ø¨ÙˆØ³Ø§Øª Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠØ©:\n' +
                'â€¢ Ù…ÙˆØ¬Ø© 5: Ù…Ù„Ùƒ Ø§Ù„Ø¸Ù„Ø§Ù…\n' +
                'â€¢ Ù…ÙˆØ¬Ø© 10: Ø§Ù„ØªÙ†ÙŠÙ† Ø§Ù„Ø£Ø³Ø·ÙˆØ±ÙŠ\n' +
                'â€¢ Ù…ÙˆØ¬Ø© 15: Ø¥Ù„Ù‡ Ø§Ù„Ø¯Ù…Ø§Ø±\n\n' +
                'ğŸ† Ø­Ø¸Ø§Ù‹ Ù…ÙˆÙÙ‚Ø§Ù‹ Ø£ÙŠÙ‡Ø§ Ø§Ù„Ù…Ø­Ø§Ø±Ø¨!');
        });

        setupControls();

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        gameLoop();
    </script>
</body>
</html>
